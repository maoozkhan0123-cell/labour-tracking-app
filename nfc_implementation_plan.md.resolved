# NFC Clock-In/Out Implementation Plan

Yes, it is absolutely possible to implement NFC functionality into the Babylon Labour Tracking System. This would allow workers to tap their phone or an NFC card against a reader to instantly track their time without manual button clicks.

## ğŸ› ï¸ Requirements & Constraints
> [!IMPORTANT]
> **Web NFC Support:** The Web NFC API currently only works on **Chrome for Android**. It is not supported on Safari (iOS) or Desktop browsers. If your workers use Android phones or you have an Android tablet at the warehouse entrance, this will work perfectly.

### 1. Hardware Needed
- **NFC Tags:** Standard NTAG213 or NTAG215 cards/stickers (very cheap).
- **Scanner:** Any NFC-enabled Android smartphone or tablet.

## ğŸ“‹ Implementation Strategy

### Phase 1: Database Updates
We need to link unique NFC Tag IDs to specific workers.
- Add an `nfc_id` (string, unique) field to the `users` table in Supabase.
- Create an "NFC Registration" tool in the Admin Portal to assign a card to a worker.

### Phase 2: The "NFC Listening" Logic
We will use the **Web NFC API (`NDEFReader`)**.
- When the Worker Portal is open, it enters a "Listening Mode."
- **Code Flow**:
  1. Initialize `new NDEFReader()`.
  2. Start scanning with `reader.scan()`.
  3. Listen for the `reading` event.
  4. Extract the serial number or token from the tag.

### Phase 3: Automatic Clock-In/Out
1. **Detection**: Worker taps their card.
2. **Verification**: The app sends the Tag ID to Supabase to find which worker it belongs to.
3. **Action**:
   - If User Status is `offline` -> Trigger `Clock In`.
   - If User Status is `present` -> Trigger `Clock Out`.
4. **Feedback**: Play a "Success" beep and show a confirmation popup.

## ğŸ”„ Interaction Flow

```mermaid
sequenceDiagram
    participant Worker as Worker Card
    participant App as Worker Portal (Tablet/Phone)
    participant DB as Supabase Database

    Worker->>App: Tap NFC Tag
    App->>App: Read Serial Number
    App->>DB: Lookup Worker by NFC ID
    DB-->>App: Return User Profile
    alt Currently Offline
        App->>DB: Log Clock-In Event
        App->>App: Show "Welcome [Name]"
    else Currently Present
        App->>DB: Log Clock-Out Event
        App->>App: Show "Goodbye [Name]"
    end
```

## ğŸš€ How we will build it
1. **Step 1**: Update the Supabase schema to include `nfc_token`.
2. **Step 2**: Add a "Register NFC Page" in Admin Portal.
3. **Step 3**: Integrate the `NDEFReader` into the [WorkerPortalPage.tsx](file:///c:/Users/ah/Desktop/Labour-Tracker-app/src/pages/WorkerPortalPage.tsx).
4. **Step 4**: Add a visual "Waiting for Tag..." heartbeat animation to the UI.

## ğŸ›¡ï¸ Security Note
To prevent someone from "cloning" a card, we can store a unique encrypted token on the tag's memory instead of just using the hardware serial number.
